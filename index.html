<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Duck — Pink & Blue (Soft Flap)</title>
  <style>
    :root{
      --bg-top:#ffd6e8;
      --bg-bottom:#d8e9ff;
      --accent:#ff79c6;
      --pipe:#5aa0ff;
      --text:#06203a;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, sans-serif;}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom));}
    .card{width:min(480px,94vw);box-shadow:0 10px 30px rgba(2,6,23,0.12);border-radius:12px;overflow:hidden;background:rgba(255,255,255,0.6);backdrop-filter:blur(4px);}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:linear-gradient(90deg,rgba(255,255,255,0.25),rgba(255,255,255,0.05));}
    h1{font-size:16px;margin:0;color:var(--text);} 
    .controls{font-size:13px;color:var(--text);opacity:0.9}
    canvas{display:block;width:100%;height:auto;background:transparent;}
    .overlay{position:relative}
    .ui{position:absolute;left:10px;top:8px;color:var(--text);font-weight:700;text-shadow:0 1px 0 rgba(255,255,255,0.6)}
    .score{position:absolute;right:10px;top:8px;color:var(--text);font-weight:800}
    .centerMessage{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);text-align:center;padding:12px}
    .btn{display:inline-block;background:var(--accent);color:white;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:700;box-shadow:0 6px 14px rgba(167,40,93,0.18)}
    .small{font-size:13px;color:var(--text);opacity:0.95}
    footer{padding:8px 12px;text-align:center;font-size:12px;color:var(--text);opacity:0.9}
    @media (max-width:420px){h1{font-size:14px}}
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>Flappy Duck</h1>
      <div class="controls">Space / Tap to flap • Pink & Blue</div>
    </header>

    <div class="overlay" style="position:relative;">
      <canvas id="game" width="480" height="640"></canvas>
      <div class="ui" id="uiLives">Lives: 1</div>
      <div class="score" id="uiScore">0</div>
      <div class="centerMessage" id="message" style="pointer-events:none;">
        <div id="startPanel">
          <h2 style="margin:0;color:var(--text)">Tap or press <strong>Space</strong> to start</h2>
          <p class="small">Steer the pink duck through blue pipes. Good luck!</p>
        </div>
        <div id="gameOver" style="display:none">
          <h2 style="margin:0;color:var(--text)">Game Over</h2>
          <p class="small" id="goScore"></p>
          <a class="btn" id="restart">Play again</a>
        </div>
      </div>
    </div>
    <footer>Made with ❤️ CEIS </footer>
    <audio src="/duck game/Duck Quack - Sound Effect (HD).mp3" id="quack"></audio>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;

    const pink = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#ff79c6';
    const blue = getComputedStyle(document.documentElement).getPropertyValue('--pipe').trim() || '#5aa0ff';
    const bgTop = getComputedStyle(document.documentElement).getPropertyValue('--bg-top').trim();
    const bgBottom = getComputedStyle(document.documentElement).getPropertyValue('--bg-bottom').trim();

    let pipes = [];
    let frame = 0;
    let score = 0;
    let running = false;
    let gameOver = false;
    let rafId = null;

    // ✅ Softer motion values
    const duck = {
      x: 90,
      y: H/2,
      w: 30,
      h: 27,
      vel: 0,
      gravity: 0.15,   // lighter gravity
      lift: -6,        // gentler lift
      damping: 0.98,   // smooth out velocity changes
      rotation: 0
    };

    const gap = 210;
    const pipeW = 60;
    const speed = 2;
    const spawnIntervalFrames = 100;

    const uiScore = document.getElementById('uiScore');
    const message = document.getElementById('message');
    const startPanel = document.getElementById('startPanel');
    const gameOverPanel = document.getElementById('gameOver');
    const restartBtn = document.getElementById('restart');
    const goScore = document.getElementById('goScore');

    function reset(){
      pipes = []; frame = 0; score = 0; running = false; gameOver = false;
      duck.y = H/2; duck.vel = 0; duck.rotation = 0;
      uiScore.textContent = '0';
      startPanel.style.display = '';
      gameOverPanel.style.display = 'none';
      message.style.pointerEvents = 'none';
      if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
      draw();
    }

    function spawnPipe(){
      const topH = 160 + Math.random() * (H - gap - 180);
      pipes.push({x: W, top: topH, passed:false});
    }

    function rectsCollide(a,b){
      return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
    }

    function duckRect(){
      return {x: duck.x - 6, y: duck.y - duck.h/2, w: duck.w - 4, h: duck.h};
    }

    function doFlap(){
      if (gameOver) return;
      // soften the lift transition
      duck.vel = duck.vel * 0.5 + duck.lift;
      running = true;
      startPanel.style.display = 'none';
      message.style.pointerEvents = 'none';
      if (!rafId) rafId = requestAnimationFrame(loop);
    }

    window.addEventListener('keydown', e=>{
      if (e.code === 'Space' || e.key === ' '){ e.preventDefault(); doFlap(); }
    });
    canvas.addEventListener('mousedown', e=>{ e.preventDefault(); doFlap(); });
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); doFlap(); }, {passive:false});
    restartBtn.addEventListener('click', ()=>{ reset(); });

    function updatePhysics(){
      frame++;
      if (running && frame % spawnIntervalFrames === 0) spawnPipe();

      // Gravity + damping
      duck.vel += duck.gravity;
      duck.vel *= duck.damping; // smooths both up and down
      if (duck.vel > 9.5) duck.vel = 9.5;

      duck.y += duck.vel;
      duck.rotation = Math.max(Math.min(duck.vel/9, 1.0), -1.0); // smoother tilt

      if (duck.y + duck.h/2 >= H){
        duck.y = H - duck.h/2; duck.vel = 0; endGame();
      }
      if (duck.y - duck.h/2 <= 0){
        duck.y = duck.h/2; duck.vel = 0;
      }

      for (let i = pipes.length - 1; i >= 0; i--){
        const p = pipes[i];
        p.x -= speed;
        const topBox = {x:p.x, y:0, w:pipeW, h:p.top};
        const botBox = {x:p.x, y:p.top + gap, w:pipeW, h:H-(p.top+gap)};
        if (!p.passed && (p.x + pipeW < duck.x)){ p.passed = true; score++; uiScore.textContent = score; quackSound();}
        if (rectsCollide(duckRect(), topBox) || rectsCollide(duckRect(), botBox)) endGame();
        if (p.x + pipeW < -20) pipes.splice(i,1);
      }
    }
    function quackSound() {
        const audio = document.getElementById("quack");
        audio.currentTime = 0;
        audio.play();
    }

    function endGame(){
      if (gameOver) return;
      gameOver = true; running = false;
      gameOverPanel.style.display = '';
      startPanel.style.display = 'none';
      goScore.textContent = 'Score: ' + score;
      message.style.pointerEvents = 'auto';
      if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
    }

    function drawBackground(){
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0,bgTop||'#ffd6e8');
      g.addColorStop(1,bgBottom||'#d8e9ff');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
      for(let i=0;i<3;i++){
        ctx.beginPath();
        ctx.globalAlpha = 0.06 + i*0.02;
        const rx = 80 + i*140 + Math.sin((Date.now()/800)+i)*40;
        ctx.ellipse(rx,80+i*40,80,28,0,0,Math.PI*2);
        ctx.fillStyle = i%2?blue:pink;
        ctx.fill();
      }
      ctx.globalAlpha=1;
    }

    function drawPipes(){
      for(const p of pipes){
        ctx.fillStyle = blue;
        roundRect(ctx,p.x,0,pipeW,p.top,8,true,false);
        roundRect(ctx,p.x,p.top+gap,pipeW,H-(p.top+gap),8,true,false);
        ctx.fillStyle = '#ffffff22';
        ctx.fillRect(p.x+pipeW-6,-4,6,H+8);
      }
    }

    function drawDuck(){
      const x=duck.x, y=duck.y;
      ctx.save(); ctx.translate(x,y); ctx.rotate(duck.rotation);
      ctx.beginPath(); ctx.ellipse(0,0,22,16,0,0,Math.PI*2);
      ctx.fillStyle=pink; ctx.fill();
      ctx.beginPath(); ctx.ellipse(-2,2,10,6,-0.6,0,Math.PI*2);
      ctx.fillStyle='#ffb7dd'; ctx.fill();
      ctx.beginPath(); ctx.moveTo(24,-2); ctx.lineTo(34,0); ctx.lineTo(24,6); ctx.closePath();
      ctx.fillStyle='#ffcc6b'; ctx.fill();
      ctx.beginPath(); ctx.arc(6,-6,3,0,Math.PI*2); ctx.fillStyle='#06203a'; ctx.fill();
      ctx.restore();
    }

    function draw(){ ctx.clearRect(0,0,W,H); drawBackground(); drawPipes(); drawDuck(); }

    function loop(){
      updatePhysics(); draw();
      if(!gameOver) rafId=requestAnimationFrame(loop); else rafId=null;
    }

    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath();
      if(fill) ctx.fill(); if(stroke) ctx.stroke();
    }

    reset();
    (function idleAnim(){
      duck.y = H/2 + Math.sin(Date.now()/600)*6;
      draw();
      if(!running && !gameOver) requestAnimationFrame(idleAnim);
    })();

    function resizeForDPR(){
      const ratio = window.devicePixelRatio||1;
      canvas.width=W*ratio; canvas.height=H*ratio;
      canvas.style.width=W+'px'; canvas.style.height=H+'px';
      ctx.setTransform(ratio,0,0,ratio,0,0);
      draw();
    }
    resizeForDPR();
    window.addEventListener('resize',resizeForDPR);
  </script>
</body>
</html>